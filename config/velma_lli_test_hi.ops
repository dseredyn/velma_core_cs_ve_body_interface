import("rtt_ros");
import("rtt_roscomm");
import("rtt_rosparam");
require("os")

ros.import("rtt_rospack")
ros.import("rtt_actionlib");
ros.import("rtt_barrett_hand_controller_msgs");
ros.import("rtt_velma_low_level_interface_msgs");
ros.import("velma_low_level_interface");
ros.import("conman");
ros.import("conman_ros");

ros.import("eigen_typekit");
ros.import("rtt_std_msgs");
ros.import("port_operations");

#
# the interfaces under test
#
var ConnPolicy cpRx;
cpRx.transport = 2;                 # the MQueue protocol id
cpRx.name_id   = "/lli_status";     # the connection id

loadComponent("lli_hi_rx","VelmaLLIHiRx")
setActivity("lli_hi_rx", 0, 1, ORO_SCHED_RT);
lli_hi_rx.configure();
stream("lli_hi_rx.status_INPORT", cpRx);

var ConnPolicy cpTx;
cpTx.transport = 2;                 # the MQueue protocol id
cpTx.name_id   = "/lli_command";    # the connection id

loadComponent("lli_hi_tx","VelmaLLIHiTx")
setActivity("lli_hi_tx", 0, 1, ORO_SCHED_RT);
lli_hi_tx.configure();
stream("lli_hi_tx.command_OUTPORT", cpTx);

#
# the actual testing component
#
loadComponent("lli_hi_test","VelmaLLIHiTest")
setActivity("lli_hi_test", 0, 1, ORO_SCHED_RT);
lli_hi_test.configure();

# command
connect("lli_hi_test.cmd_rArm_t_OUTPORT",         "lli_hi_tx.cmd_rArm_t_INPORT", ConnPolicy())
connect("lli_hi_test.cmd_rArm_cmd_OUTPORT",       "lli_hi_tx.cmd_rArm_cmd_INPORT", ConnPolicy())
connect("lli_hi_test.cmd_rHand_q_OUTPORT",        "lli_hi_tx.cmd_rHand_q_INPORT", ConnPolicy())
connect("lli_hi_test.cmd_rHand_dq_OUTPORT",       "lli_hi_tx.cmd_rHand_dq_INPORT", ConnPolicy())
connect("lli_hi_test.cmd_rHand_max_p_OUTPORT",    "lli_hi_tx.cmd_rHand_max_p_INPORT", ConnPolicy())
connect("lli_hi_test.cmd_rHand_max_i_OUTPORT",    "lli_hi_tx.cmd_rHand_max_i_INPORT", ConnPolicy())
connect("lli_hi_test.cmd_rHand_hold_OUTPORT",     "lli_hi_tx.cmd_rHand_hold_INPORT", ConnPolicy())

connect("lli_hi_test.cmd_lArm_t_OUTPORT",         "lli_hi_tx.cmd_lArm_t_INPORT", ConnPolicy())
connect("lli_hi_test.cmd_lArm_cmd_OUTPORT",       "lli_hi_tx.cmd_lArm_cmd_INPORT", ConnPolicy())
connect("lli_hi_test.cmd_lHand_q_OUTPORT",        "lli_hi_tx.cmd_lHand_q_INPORT", ConnPolicy())
connect("lli_hi_test.cmd_lHand_dq_OUTPORT",       "lli_hi_tx.cmd_lHand_dq_INPORT", ConnPolicy())
connect("lli_hi_test.cmd_lHand_max_p_OUTPORT",    "lli_hi_tx.cmd_lHand_max_p_INPORT", ConnPolicy())
connect("lli_hi_test.cmd_lHand_max_i_OUTPORT",    "lli_hi_tx.cmd_lHand_max_i_INPORT", ConnPolicy())
connect("lli_hi_test.cmd_lHand_hold_OUTPORT",     "lli_hi_tx.cmd_lHand_hold_INPORT", ConnPolicy())

connect("lli_hi_test.cmd_rHand_tactileCmd_OUTPORT",   "lli_hi_tx.cmd_rHand_tactileCmd_INPORT", ConnPolicy())
connect("lli_hi_test.cmd_tMotor_i_OUTPORT",           "lli_hi_tx.cmd_tMotor_i_INPORT", ConnPolicy())
connect("lli_hi_test.cmd_hpMotor_i_OUTPORT",          "lli_hi_tx.cmd_hpMotor_i_INPORT", ConnPolicy())
connect("lli_hi_test.cmd_htMotor_i_OUTPORT",          "lli_hi_tx.cmd_htMotor_i_INPORT", ConnPolicy())
connect("lli_hi_test.cmd_hpMotor_q_OUTPORT",          "lli_hi_tx.cmd_hpMotor_q_INPORT", ConnPolicy())
connect("lli_hi_test.cmd_htMotor_q_OUTPORT",          "lli_hi_tx.cmd_htMotor_q_INPORT", ConnPolicy())
connect("lli_hi_test.cmd_hpMotor_dq_OUTPORT",         "lli_hi_tx.cmd_hpMotor_dq_INPORT", ConnPolicy())
connect("lli_hi_test.cmd_htMotor_dq_OUTPORT",         "lli_hi_tx.cmd_htMotor_dq_INPORT", ConnPolicy())

# status
connect("lli_hi_rx.status_rArm_q_OUTPORT",              "lli_hi_test.status_rArm_q_INPORT", ConnPolicy())
connect("lli_hi_rx.status_rArm_dq_OUTPORT",             "lli_hi_test.status_rArm_dq_INPORT", ConnPolicy())
connect("lli_hi_rx.status_rArm_t_OUTPORT",              "lli_hi_test.status_rArm_t_INPORT", ConnPolicy())
connect("lli_hi_rx.status_rArm_gt_OUTPORT",             "lli_hi_test.status_rArm_gt_INPORT", ConnPolicy())
connect("lli_hi_rx.status_rArm_w_OUTPORT",              "lli_hi_test.status_rArm_w_INPORT", ConnPolicy())
connect("lli_hi_rx.status_rArm_mmx_OUTPORT",            "lli_hi_test.status_rArm_mmx_INPORT", ConnPolicy())
connect("lli_hi_rx.status_rArm_friIntfState_OUTPORT",   "lli_hi_test.status_rArm_friIntfState_INPORT", ConnPolicy())
connect("lli_hi_rx.status_rArm_friRobotState_OUTPORT",  "lli_hi_test.status_rArm_friRobotState_INPORT", ConnPolicy())
connect("lli_hi_rx.status_rHand_q_OUTPORT",             "lli_hi_test.status_rHand_q_INPORT", ConnPolicy())
connect("lli_hi_rx.status_rHand_s_OUTPORT",             "lli_hi_test.status_rHand_s_INPORT", ConnPolicy())

connect("lli_hi_rx.status_lArm_q_OUTPORT",              "lli_hi_test.status_lArm_q_INPORT", ConnPolicy())
connect("lli_hi_rx.status_lArm_dq_OUTPORT",             "lli_hi_test.status_lArm_dq_INPORT", ConnPolicy())
connect("lli_hi_rx.status_lArm_t_OUTPORT",              "lli_hi_test.status_lArm_t_INPORT", ConnPolicy())
connect("lli_hi_rx.status_lArm_gt_OUTPORT",             "lli_hi_test.status_lArm_gt_INPORT", ConnPolicy())
connect("lli_hi_rx.status_lArm_w_OUTPORT",              "lli_hi_test.status_lArm_w_INPORT", ConnPolicy())
connect("lli_hi_rx.status_lArm_mmx_OUTPORT",            "lli_hi_test.status_lArm_mmx_INPORT", ConnPolicy())
connect("lli_hi_rx.status_lArm_friIntfState_OUTPORT",   "lli_hi_test.status_lArm_friIntfState_INPORT", ConnPolicy())
connect("lli_hi_rx.status_lArm_friRobotState_OUTPORT",  "lli_hi_test.status_lArm_friRobotState_INPORT", ConnPolicy())
connect("lli_hi_rx.status_lHand_q_OUTPORT",             "lli_hi_test.status_lHand_q_INPORT", ConnPolicy())
connect("lli_hi_rx.status_lHand_s_OUTPORT",             "lli_hi_test.status_lHand_s_INPORT", ConnPolicy())

connect("lli_hi_rx.status_tMotor_q_OUTPORT",            "lli_hi_test.status_tMotor_q_INPORT", ConnPolicy())
connect("lli_hi_rx.status_tMotor_dq_OUTPORT",           "lli_hi_test.status_tMotor_dq_INPORT", ConnPolicy())
connect("lli_hi_rx.status_hpMotor_q_OUTPORT",           "lli_hi_test.status_hpMotor_q_INPORT", ConnPolicy())
connect("lli_hi_rx.status_hpMotor_dq_OUTPORT",          "lli_hi_test.status_hpMotor_dq_INPORT", ConnPolicy())
connect("lli_hi_rx.status_htMotor_q_OUTPORT",           "lli_hi_test.status_htMotor_q_INPORT", ConnPolicy())
connect("lli_hi_rx.status_htMotor_dq_OUTPORT",          "lli_hi_test.status_htMotor_dq_INPORT", ConnPolicy())
connect("lli_hi_rx.status_rHand_p_OUTPORT",             "lli_hi_test.status_rHand_p_INPORT", ConnPolicy())
connect("lli_hi_rx.status_lHand_f_OUTPORT",             "lli_hi_test.status_lHand_f_INPORT", ConnPolicy())

connect("lli_hi_rx.status_rFt_rw_OUTPORT",              "lli_hi_test.status_rFt_rw_INPORT", ConnPolicy())
connect("lli_hi_rx.status_rFt_ffw_OUTPORT",             "lli_hi_test.status_rFt_ffw_INPORT", ConnPolicy())
connect("lli_hi_rx.status_rFt_sfw_OUTPORT",             "lli_hi_test.status_rFt_sfw_INPORT", ConnPolicy())
connect("lli_hi_rx.status_lFt_rw_OUTPORT",              "lli_hi_test.status_lFt_rw_INPORT", ConnPolicy())
connect("lli_hi_rx.status_lFt_ffw_OUTPORT",             "lli_hi_test.status_lFt_ffw_INPORT", ConnPolicy())
connect("lli_hi_rx.status_lFt_sfw_OUTPORT",             "lli_hi_test.status_lFt_sfw_INPORT", ConnPolicy())


//------------------------------------------------------------------------------
//-- Controller manager
//------------------------------------------------------------------------------
loadComponent("scheme", "conman::Scheme");
setActivity("scheme", 0, 5, ORO_SCHED_RT);
scheme.loadService("conman_ros");
scheme.configure();

addPeer("lli_hi_rx", "scheme");

addPeer("scheme", "lli_hi_tx");
addPeer("scheme", "lli_hi_test");
scheme.addBlock("lli_hi_tx");
scheme.addBlock("lli_hi_test");

scheme.start();

lli_hi_rx.start();
lli_hi_tx.start();
lli_hi_test.start();

